<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>IIH Widget</title>
  <style>
    :root {
      --bg1:#2a0e0a; 
      --bg2:#1c0b07;
      --text:#f8e8df; 
      --accent1:#f99f88; 
      --accent2:#f6bda6; 
      --barbg:#3a1a14;
      font-family:"Poppins",sans-serif;
    }

    html,body {
      margin:0;
      background:transparent;
      overflow:hidden;
    }

    .wrap {
      box-sizing:border-box;
      padding:32px;
      max-width:520px;
      margin:auto;
      border-radius:24px;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--text);
      box-shadow:0 6px 20px rgba(0,0,0,0.4);
      text-align:center;
    }

    h2 {
      font-size:1.4em;
      font-weight:700;
      margin-bottom:8px;
      color:var(--accent2);
      letter-spacing:0.5px;
    }

    p {
      color:#f1d3c5;
      font-size:0.95em;
      margin-bottom:20px;
    }

    #iih-value {
      font-size:4em;
      font-weight:800;
      margin:10px 0;
      color:var(--accent1);
    }

    #iih-status {
      font-size:1.1em;
      color:var(--accent2);
      margin-bottom:20px;
    }

    .bar {
      height:12px;
      width:100%;
      background:var(--barbg);
      border-radius:10px;
      overflow:hidden;
      margin-bottom:15px;
    }

    .fill {
      height:100%;
      width:0;
      background:linear-gradient(90deg,#f99f88,#f6bda6);
      border-radius:10px;
      transition:width 1s ease;
    }

    small {
      display:block;
      color:#e0b7a7;
    }

    @media(max-width:600px){
      .wrap{padding:20px;}
      #iih-value{font-size:2.8em;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>IIH ‚Äî √çNDICE DE INTERACCI√ìN HUMANA</h2>
    <p>Nivel de conexi√≥n, bienestar y cultura activa en espacios Adiuvat.</p>

    <div id="iih-value">--</div>
    <div id="iih-status">Cargando datos...</div>

    <div class="bar">
      <div id="iih-fill" class="fill"></div>
    </div>

    <small>Datos verificados por Adiuvat DApp ¬∑ √çndice Macro</small>
  </div>

  <script>
  (function(){
    const api = "https://script.google.com/macros/s/AKfycbxI0v_gry_nEoSPrQOIzpKl7Arvu8lNlpyVi4zz7TB0tfH3e_rIHL9dtrp4jO5YZWgo/exec";
    const valEl = document.getElementById("iih-value");
    const statusEl = document.getElementById("iih-status");
    const fillEl = document.getElementById("iih-fill");

    async function load(){
      try {
        const res = await fetch(api, { cache: "no-cache" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        if(!data || typeof data.value === "undefined") throw new Error("Respuesta inv√°lida");

        const value = Math.round(data.value);
        const level = data.level || "Sin datos";
        let color = "#d35b43";
        if(value > 25) color = "#f27a56";
        if(value > 50) color = "#f6bda6";
        if(value > 75) color = "#ffd7b5";

        valEl.textContent = value;
        valEl.style.color = color;
        statusEl.textContent = "Interacci√≥n " + level;
        fillEl.style.width = value + "%";
        fillEl.style.background = "linear-gradient(90deg," + color + ", #f6bda6)";
      } catch(e){
        valEl.textContent = "--";
        statusEl.textContent = "Error al cargar √≠ndice";
        fillEl.style.width = "0%";
      }

      // üî∏ enviar altura din√°mica al iframe padre
      setTimeout(() => {
        window.parent.postMessage({ type: "resizeIIH", height: document.body.scrollHeight }, "*");
      }, 300);
    }

    document.addEventListener("DOMContentLoaded", load);
  })();
  </script>
</body>
</html>
